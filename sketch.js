let jokes = ["3 logicians walk into a bar. The bartender asks: Do all of you want a drink? The first logician says \"I don't know\". The second logician says \"I don't know\" the third logician says \"Yes!\"", "There are only 10 types of people in the world: those that understand binary and those that don\u2019t.", "Computers make very fast and very accurate mistakes.", "Be nice to the nerds; for all you know they might be the next Bill Gates!", "Artificial intelligence usually beats real stupidity.", "To err is human \u2013 and to blame it on a computer is even more so.", "CAPS LOCK \u2013 Preventing Login Since 1980.", "The truth is out there. Anybody got the URL?", "The Internet: where men are men women are men and children are FBI agents.", "Some things Man was never meant to know. For everything else there\u2019s Google.", "The box said \u2018Requires Windows Vista or better\u2019. So I installed LINUX.", "UNIX is basically a simple operating system... but you have to be a genius to understand the simplicity.", "In a world without fences and walls... who needs Gates and Windows?", "C://dos	<br>C://dos.run	<br>run.dos.run", "Bugs come in through open Windows.", "Penguins love cold... they wont survive the sun.", "Unix is user friendly. It\u2019s just selective about who its friends are.", "Failure is not an option. It comes bundled with your Microsoft product.", "NT is the only OS that has caused me to beat a piece of hardware to death with my bare hands.", "My daily Unix command list: unzip; strip; touch; finger; mount; fsck; more; yes; unmount; sleep.", "Microsoft: \u201cYou\u2019ve got questions. We\u2019ve got dancing paperclips.\u201d", "Erik Naggum: \u201cMicrosoft is not the answer. Microsoft is the question. NO is the answer.\u201d", "Windows isn\u2019t a virus atleast viruses do something.", "Computers are like air conditioners: they stop working when you open Windows.", "Mac users swear by their Mac and PC users swear at their PC.", "If at first you don\u2019t succeed; call it version 1.0.", "My software never has bugs. It just develops random features.", "I would love to change the world but they won\u2019t give me the source code.", "The code that is the hardest to debug is the code that you know cannot possibly be wrong.", "Beware of programmers that carry screwdrivers.", "Programming today is a race between software engineers striving to build bigger and better idiot-proof programs and the Universe trying to produce bigger and better idiots. So far the Universe is winning.", "The beginning of the programmer\u2019s wisdom is understanding the difference between getting program to run and having a runnable program.", "I\u2019m not anti-social; I\u2019m just not user friendly.", "Hey! It compiles! Ship it!", "If Ruby is not and Perl is the answer then you don\u2019t understand the question.", "The more I C.... the less I see.", "COBOL programmers understand why women hate periods.", "Michael Sinz: \u201cProgramming is like sex... one mistake and you have to support it for the rest of your life.\u201d", "If you give someone a program... you will frustrate them for a day; if you teach them how to program... you will frustrate them for a lifetime.", "Programmers are tools for converting caffeine into code.", "My attitude isn\u2019t bad. It\u2019s in beta.", "Enter any 11-digit prime number to continue.", "E-mail returned to sender... insufficient voltage.", "All wiyht. Rho sritched mg kegtops awound?", "Black holes are where God divided by zero.", "If I wanted a warm fuzzy feeling... I\u2019d antialias my graphics!", "If brute force doesn\u2019t solve your problems... then you aren\u2019t using enough.", "SUPERCOMPUTER: what it sounded like before you bought it.", "Evolution is God\u2019s way of issuing upgrades.", "Linus Torvalds: \u201cReal men don\u2019t use backups... they post their stuff on a public ftp server and let the rest of the world make copies.\u201d", "Hacking is like sex. You get in... you get out... and hope that you didn\u2019t leave something that can be traced back to you.", "There are three kinds of people: those who can count and those who can\u2019t.", "Latest survey shows that 3 out of 4 people make up 75% of the world\u2019s population.", "Hand over the calculator... friends don\u2019t let friends derive drunk.", "An infinite crowd of mathematicians enters a bar. The first one orders a pint... the second one a half pint... the third one a quarter pint\u2026 \u201cI understand\u201d... says the bartender \u2013 and pours two pints.", "1f u c4n r34d th1s u r34lly n33d t0 g37 l41d.", "Theres no place like 127.0.0.1", "Real programmers start counting from 0", "If the box says: 'This software requires Windows 7 or better' Does that mean it'll run on Linux?", "I don't see women as objects. I consider each to be in a class of her own.", "I've got a really good UDP joke to tell you, but i don't know if you'll get it", "Pluto is actually an orbiting group of British soldiers from the American Revolution who entered space after the Chuck gave them a roundhouse kick to the face.", "There is in fact an 'I' in Norris, but there is no 'team'. Not even close.", "An anagram for Walker Texas Ranger is KARATE WRANGLER SEX. I don't know what that is, but it sounds AWESOME.", "Science Fact: Roundhouse kicks are comprised primarily of an element called Chucktanium.", "Superman once watched an episode of Walker, Texas Ranger. He then cried himself to sleep.", "The movie 'Delta Force' was extremely hard to make because Chuck had to downplay his abilities. The first few cuts were completely unbelievable.", "Movie trivia: The movie 'Invasion U.S.A.' is, in fact, a documentary.", "Once you go Norris, you are physically unable to go back.", "Wo hu cang long. The translation from Mandarin Chinese reads: 'Crouching Chuck, Hidden Norris'", "In an act of great philanthropy, Chuck made a generous donation to the American Cancer Society. He donated 6,000 dead bodies for scientific research.", "Crime does not pay - unless you are an undertaker following Walker, Texas Ranger, on a routine patrol.", "Coroners refer to dead people as 'ABC's'. Already Been Chucked.", "Those aren't credits that roll after Walker Texas Ranger. It is actually a list of fatalities that occurred during the making of the episode.", "All browsers support the hex definitions #chuck and #norris for the colors black and blue.", "MySpace actually isn't your space, it's Chuck's (he just lets you use it).", "No statement can catch the ChuckNorrisException.", "What does a subatomic duck say? Quark.", "Why does a burger have less energy than a steak? A burger is in its ground state.", "Why did I divide sin by tan? Just cos.", "How many theoretical physicists does it take to screw in a light bulb? Two. One to hold the bulb and one to rotate the universe.", "Why do fish likes nibbles the size of 2^n? So they can byte", "There are only 10 types of people in the world: those that understand binary, those that don\u2019t, and those that didn't expect a ternary joke.", "Programmer (noun.): A machine that turns coffee into code", "Algorith (noun.): Word used by programmers when... they do not want to explain what they did.", "What's the object-oriented way to become wealthy? Inheritance.", "Why did the programmer quit his job? Because he didn't get arrays.", "What do computers and air conditioners have in common? They both become useless when you open windows.", "Why do Java programmers have to wear glasses? Because they don't C#.", "A foo walks into a bar, takes a look around and says \"Hello World!\".", "3 Database SQL walked into a NoSQL bar. A little while later they walked out, because they couldn't find a table.", "UNIX is user friendly, it's just very particular about who it's friends are.", "Why is C sad? Because C++ told him \"You have no class\".", "Why are fishes illiterate?Because C doesnt have Classes", "Who called it female foeticide and not Binary ?", "Le gf: I'll dump you.Le bf: hex dump or binary dump? ", "How does a Programmer COok food ? In O(1)", "binary digits are called bits i love ternary digits", "Yuvraj's Batting- 1 1 0 1 1 1 0 0 1 0 0 1 0 1 0 1 0 1 1 0 W.He has specialization in Digital Electronics.", "Why did Microsoft release Windows 10 ( and not windows 9) ?Because 7 8 9", "Gotta love the people who wrote the algorithm for Ola share,They go out of their way to help others", "Linux: Born to be root. Windows: Born to re-boot", "I can't access Git. I guess I have... commitment issues", "Don't fart in an Apple Store, because they don't have Windows.", "I have a good joke on Information Technology, but you won't get IT", "Do you have a girlfriend? I will leave the relationship to the databases", "Roses are #ff0000, violets are #0000ff, I use hex codes, but I'd use RGB for you", "Java programmers are some of the most materialistic people I know, very object-oriented", "SON: What are clouds made of? DAD: Linux servers, mostly", "SHE: Are you just gonna sit here on the computer OR are we going out? HE: Yes", "CPU (Coffee Processing Unit)", "I told him I can't open the jar, he said download and install Java", "'Knock knock.' 'Who's there?' *10 mins later* 'Java.'", "A programmer is having trouble with his keyboard double-pressing. He asks his coworker what he should do. 'Hit it,' he says. The programmer hits it, but nothing changes. His coworker exclaims 'No, really BASH it!'", "Why did the chicken cross the road? It was called with theOtherSide(chicken)", "How do you tell an introverted computer scientist from an extroverted computer scientist? The extrovert looks at *your* shoes when he talks to you.", "Why Do programmers always mix up Haloween and Christmas? Because Oct31 == Dec25.", "Why did the programmer die in the shower? The shampoo bottle said: Wash, rinse, repeat.", "A UDP packet walks into a bar. The bartender doesn't acknowledge him.", "99 Bugs in the Code.	99 Bugs in the Code.	You take one down, patch it around, 127 Bugs in the code"];

let drone_sprite;
let guy_sprite1;
let guy_sprite2;
let guy_sprite3;
let lightning_sprite1;
let lightning_sprite2;
let lightning_sprite3;
let lightning_sprite4;
let lightning_sprite5;
let lightning_sprite6;
let lightning_sprite7;

let drone_audio;
let birdnoise;
let music;
let lightning_audio;

let d;
let guy;
let target;
let prelogo;
let lightning;

let up_rectx;
let up_recty;
let up_rectw;
let up_recth;

let down_rectx;
let down_recty;
let down_rectw;
let down_recth;

let right_rectx;
let right_recty;
let right_rectw;
let right_recth;

let left_rectx;
let left_recty;
let left_rectw;
let left_recth;


let right = 0;
let left = 0;
let up = 0;
let down = 0;
let turbo = 0;
let stop = 0;

let stage2_trigger = 0;
let stage2 = 0;

let joke;

function value_limit(val, min, max) {
	return val < min ? min : (val > max ? max : val);
}

function birdnoise_loaded() {
	birdnoise.setVolume(0.1);
	birdnoise.loop();
}

function music_loaded() {
	music.setVolume(0.2);
	music.loop();
}

function preload() {
	drone_sprite = loadImage("assets/sprites/d.png");
	guy_sprite1 = loadImage("assets/sprites/RedHackerGuy.png");
	guy_sprite2 = loadImage("assets/sprites/RedHackerGuy_HandsUp.png");
	guy_sprite3 = loadImage("assets/sprites/RedHackerGuy_HeadDown.png");

	lightning_sprite1 = loadImage("assets/sprites/LightningEffectAnimation1.png");
	lightning_sprite2 = loadImage("assets/sprites/LightningEffectAnimation2.png");
	lightning_sprite3 = loadImage("assets/sprites/LightningEffectAnimation3.png");
	lightning_sprite4 = loadImage("assets/sprites/LightningEffectAnimation4.png");
	lightning_sprite5 = loadImage("assets/sprites/LightningEffectAnimation5.png");
	lightning_sprite6 = loadImage("assets/sprites/LightningEffectAnimation6.png");
	lightning_sprite7 = loadImage("assets/sprites/LightningEffectAnimation7.png");

	logo = loadImage("assets/sprites/logo.png");

	drone_audio = loadSound("assets/audio/drone.ogg");
	lightning_audio = loadSound("assets/audio/Lightning-strike.mp3");

	pixel_font = loadFont("assets/fonts/joystix monospace.ttf");
}

function setup() {
	createCanvas(windowWidth, windowHeight);
	textFont(pixel_font);
	textSize(124);
	textStyle(BOLD);
	textAlign(CENTER);

	birdnoise = loadSound("assets/audio/birdnoise.ogg", birdnoise_loaded);
	music = loadSound("assets/audio/town.ogg", music_loaded);

	d = new Drone();
	guy = new Animation(guy_sprite1, guy_sprite2, guy_sprite3);
	lightning = new Animation(lightning_sprite1, lightning_sprite2, lightning_sprite3, lightning_sprite4, lightning_sprite5, lightning_sprite6, lightning_sprite7);
	
	setup_logo();

	drone_audio.loop();
	drone_audio.playMode('restart');

	lightning_audio.playMode('untilDone');

	choose_joke();
}
 
function draw() {

	dynamic_effects();

	// optional hitboxes here
	// noFill();
	// rect(prelogo.x, prelogo.y, prelogo.w, prelogo.h);
	// rect(up_rectx, up_recty, up_rectw, up_recth);
	// rect(down_rectx, down_recty, down_rectw, down_recth);
	// rect(left_rectx, left_recty, left_rectw, left_recth);
	// rect(right_rectx, right_recty, right_rectw, right_recth);

	fill(0);
	if (stage2){
		image(logo, (windowWidth / 2 - logo.width / 2) - 21, (windowHeight / 2 - logo.height / 2) - 82, logo.width*1.1, logo.height*1.1);
	}
	else
		text('EITC', windowWidth / 2, windowHeight / 2);
	
	guy.animate(
		0.1,
		20,
		windowHeight - guy_sprite1.height * 0.15,
		guy_sprite1.width * 0.15,
		guy_sprite1.height * 0.15
	);

	show_joke();

	d.update();
	d.show();

	if (stage2_trigger){
		push();
		filter(INVERT);
		lightning.animate(0.6, target.x - (target.y*0.9)/2 + 40, 0, target.y*0.9, target.y*0.9);
		lightning_audio.play();
		setTimeout(function() {pop(); stage2_trigger = 0;}, 400);
	}
}

function windowResized() {
	resizeCanvas(windowWidth, windowHeight);
	setup_logo();
}

function keyPressed() {
	if (keyCode === UP_ARROW) {
		up = 1;
	}
	if (keyCode === DOWN_ARROW) {
		down = 1;
	}
	if (keyCode === LEFT_ARROW) {
		left = 1;
	}
	if (keyCode === RIGHT_ARROW) {
		right = 1;
	}
	if (keyCode === SHIFT) {
		turbo = 3;
	}
	if (keyCode === 83) { // S key
		stop = 1;
	}
}

function keyReleased() {
	if (keyCode === UP_ARROW) {
		up = 0;
	}
	if (keyCode === DOWN_ARROW) {
		down = 0;
	}
	if (keyCode === LEFT_ARROW) {
		left = 0;
	}
	if (keyCode === RIGHT_ARROW) {
		right = 0;
	}
	if (keyCode === SHIFT) {
		turbo = 0;
	}
	if (keyCode === 83) { // S key
		stop = 0;
	}
}

function setup_logo() {
	target = createVector(windowWidth/2 - 70, windowHeight/2 - 72);
	prelogo = pixel_font.textBounds('EITC', windowWidth / 2, windowHeight / 2);
	// padding
	prelogo.x -= 5;
	prelogo.y -= 5;
	prelogo.w += 10;
	prelogo.h += 10;

	up_rectx = prelogo.x;
	up_recty = 0;
	up_rectw = prelogo.w;
	up_recth = prelogo.y;

	down_rectx = prelogo.x;
	down_recty = prelogo.y + prelogo.h;
	down_rectw = prelogo.w;
	down_recth = windowHeight - (prelogo.y + prelogo.h);

	right_rectx = prelogo.x + prelogo.w;
	right_recty = prelogo.y;
	right_rectw = windowWidth - (prelogo.x + prelogo.w);
	right_recth = prelogo.h;

	left_rectx = 0;
	left_recty = prelogo.y;
	left_rectw = prelogo.x;
	left_recth = prelogo.h;
}

function dynamic_effects() {
	let speedup;

	if (!stage2) {
		// background fade
		let fade = 100000 / Math.pow(dist(d.position.x, d.position.y, target.x, target.y), 2);
		fade = value_limit(fade, 0, 100);
		background(255 - fade);
	
		// music fx
		speedup = 100000 / Math.pow(dist(d.position.x, d.position.y, target.x, target.y), 3);
		speedup = value_limit(speedup, 0, 2);

	} else {
		background(255);
		speedup = 0
	}

	drone_audio.setVolume(0.05 + 0.05 * (d.velocity.mag()/12));
	music.rate(1 + speedup);
}

function choose_joke() {
	joke = jokes[floor(random(jokes.length))];
}

function show_joke() {
	push();
	fill(0);
	textFont(pixel_font);
	textSize(13);
	textAlign(CENTER)
	text(joke, prelogo.x, prelogo.y + 300, prelogo.w, 300);
	pop();
}